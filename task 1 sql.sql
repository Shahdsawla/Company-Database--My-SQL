CREATE DATABASE companydb;
USE companydb;


CREATE TABLE EMPLOYEE (
  SSN        CHAR(9)      PRIMARY KEY,
  FNAME      VARCHAR(20),
  MINIT      CHAR(1),
  LNAME      VARCHAR(20),
  BDATE      DATE,
  ADDRESS    VARCHAR(50),
  SEX        CHAR(1),
  SALARY     DECIMAL(10,2),
  SUPERSSN   CHAR(9),
  DNO        INT
);

CREATE TABLE DEPARTMENT (
  DNUMBER      INT        PRIMARY KEY,
  DNAME        VARCHAR(20),
  MGRSSN       CHAR(9),
  MGRSTARTDATE DATE
);

CREATE TABLE DEPT_LOCATIONS (
  DNUMBER   INT,
  DLOCATION VARCHAR(20),
  PRIMARY KEY (DNUMBER, DLOCATION)
);

CREATE TABLE PROJECT (
  PNUMBER   INT           PRIMARY KEY,
  PNAME     VARCHAR(20),
  PLOCATION VARCHAR(20),
  DNUM      INT
);

CREATE TABLE WORKS_ON (
  ESSN  CHAR(9),
  PNO   INT,
  HOURS DECIMAL(3,1),
  PRIMARY KEY (ESSN, PNO)
);

CREATE TABLE DEPENDENT (
  ESSN            CHAR(9),
  DEPENDENT_NAME  VARCHAR(20),
  SEX             CHAR(1),
  BDATE           DATE,
  RELATIONSHIP    VARCHAR(20),
  PRIMARY KEY (ESSN, DEPENDENT_NAME)
);


ALTER TABLE EMPLOYEE
  ADD CONSTRAINT fk_employee_super
  FOREIGN KEY (SUPERSSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE EMPLOYEE
  ADD CONSTRAINT fk_employee_dept
  FOREIGN KEY (DNO) REFERENCES DEPARTMENT(DNUMBER);

ALTER TABLE DEPARTMENT
  ADD CONSTRAINT fk_dept_mgr
  FOREIGN KEY (MGRSSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE DEPT_LOCATIONS
  ADD CONSTRAINT fk_dept_locations_dept
  FOREIGN KEY (DNUMBER) REFERENCES DEPARTMENT(DNUMBER)
  ON DELETE CASCADE
  ON UPDATE CASCADE;

ALTER TABLE PROJECT
  ADD CONSTRAINT fk_project_dept
  FOREIGN KEY (DNUM) REFERENCES DEPARTMENT(DNUMBER);

ALTER TABLE WORKS_ON
  ADD CONSTRAINT fk_workson_emp
  FOREIGN KEY (ESSN) REFERENCES EMPLOYEE(SSN);

ALTER TABLE WORKS_ON
  ADD CONSTRAINT fk_workson_project
  FOREIGN KEY (PNO) REFERENCES PROJECT(PNUMBER);

ALTER TABLE DEPENDENT
  ADD CONSTRAINT fk_dependent_emp
  FOREIGN KEY (ESSN) REFERENCES EMPLOYEE(SSN);


INSERT INTO DEPARTMENT (DNUMBER, DNAME, MGRSSN, MGRSTARTDATE) VALUES
(1, 'IT', NULL, '2022-01-01'),
(2, 'HR', NULL, '2023-03-15');


INSERT INTO EMPLOYEE
(SSN, FNAME, MINIT, LNAME, BDATE, ADDRESS, SEX, SALARY, SUPERSSN, DNO)
VALUES
('123456789', 'Sara', 'A', 'Ali',    '1998-05-10', 'Cairo', 'F', 15000.00, NULL,        1),
('987654321', 'Omar', 'M', 'Hassan', '1997-08-20', 'Giza',  'M', 14000.00, '123456789', 2),
('555666777', 'Mona', 'K', 'Saad',   '1999-02-14', 'Cairo', 'F', 13000.00, '123456789', 1);


UPDATE DEPARTMENT SET MGRSSN = '123456789' WHERE DNUMBER = 1;
UPDATE DEPARTMENT SET MGRSSN = '987654321' WHERE DNUMBER = 2;


INSERT INTO DEPT_LOCATIONS (DNUMBER, DLOCATION) VALUES
(1, 'Cairo'),
(1, 'Alexandria'),
(2, 'Giza'),
(2, 'Cairo');

INSERT INTO PROJECT (PNUMBER, PNAME, PLOCATION, DNUM) VALUES
(10, 'HospitalSys', 'Cairo', 1),
(20, 'HRPortal',    'Giza',  2);


INSERT INTO WORKS_ON (ESSN, PNO, HOURS) VALUES
('123456789', 10, 20.0),
('123456789', 20, 10.0),
('987654321', 20, 15.5),
('555666777', 10, 12.0);


INSERT INTO DEPENDENT (ESSN, DEPENDENT_NAME, SEX, BDATE, RELATIONSHIP) VALUES
('123456789', 'Laila',   'F', '2015-04-12', 'Daughter'),
('987654321', 'Mahmoud', 'M', '2012-11-05', 'Son');





